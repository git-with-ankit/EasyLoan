<div class="emi-preview-container">
    <h3>EMI Plan Preview</h3>

    <!-- Summary Cards -->
    <div class="summary-cards">
        <div class="summary-card">
            <div class="card-label">Loan Amount</div>
            <div class="card-value">₹{{ requestedAmount | number:'1.2-2' }}</div>
        </div>
        <div class="summary-card">
            <div class="card-label">Interest Rate</div>
            <div class="card-value">{{ loanType.interestRate }}%</div>
        </div>
        <div class="summary-card">
            <div class="card-label">Tenure</div>
            <div class="card-value">{{ tenure }} months</div>
        </div>
        <div class="summary-card highlight">
            <div class="card-label">Monthly EMI</div>
            <div class="card-value">₹{{ monthlyEmi | number:'1.2-2' }}</div>
        </div>
    </div>

    <!-- EMI Schedule Table -->
    <div class="table-container">
        <table class="emi-table">
            <thead>
                <tr>
                    <th>EMI #</th>
                    <th>Due Date</th>
                    <th>Principal</th>
                    <th>Interest</th>
                    <th>Total EMI</th>
                    <th>Principal Remaining</th>
                </tr>
            </thead>
            <tbody>
                @for (emi of paginatedEmiPlan; track emi.emiNumber) {
                <tr>
                    <td>{{ emi.emiNumber }}</td>
                    <td>{{ emi.dueDate | date:'mediumDate' }}</td>
                    <td>₹{{ emi.principalComponent | number:'1.2-2' }}</td>
                    <td>₹{{ emi.interestComponent | number:'1.2-2' }}</td>
                    <td class="total-emi">₹{{ emi.totalEmiAmount | number:'1.2-2' }}</td>
                    <td>₹{{ emi.principalRemainingAfterPayment | number:'1.2-2' }}</td>
                </tr>
                }
            </tbody>
            <tfoot>
                <tr class="total-row">
                    <td colspan="2"><strong>Total</strong></td>
                    <td><strong>₹{{ totalPrincipal | number:'1.2-2' }}</strong></td>
                    <td><strong>₹{{ totalInterest | number:'1.2-2' }}</strong></td>
                    <td class="total-emi"><strong>₹{{ totalAmount | number:'1.2-2' }}</strong></td>
                    <td>₹0.00</td>
                </tr>
            </tfoot>
        </table>

        <mat-paginator [length]="emiPlan.length" [pageSize]="pageSize" [pageSizeOptions]="pageSizeOptions"
            (page)="onPageChange($event)" aria-label="Select page of EMI plan">
        </mat-paginator>
    </div>

    <div class="info-note">
        <span class="note-icon">ℹ️</span>
        <p>This is an estimated EMI plan. Actual EMI schedule will be generated after loan approval.</p>
    </div>
</div>