<div class="page-container">
    <div class="header-section">
        <h1>Assigned Applications</h1>
    </div>

    <mat-tab-group>
        <!-- Pending Tab -->
        <mat-tab label="Pending">
            <div class="table-container mat-elevation-z2">
                <table mat-table [dataSource]="pendingState().data">
                    <!-- Columns -->
                    <ng-container matColumnDef="applicationNumber">
                        <th mat-header-cell *matHeaderCellDef> App Number </th>
                        <td mat-cell *matCellDef="let app"> {{app.applicationNumber}} </td>
                    </ng-container>

                    <ng-container matColumnDef="loanType">
                        <th mat-header-cell *matHeaderCellDef> Loan Type </th>
                        <td mat-cell *matCellDef="let app"> {{app.loanTypeName}} </td>
                    </ng-container>

                    <ng-container matColumnDef="amount">
                        <th mat-header-cell *matHeaderCellDef> Amount </th>
                        <td mat-cell *matCellDef="let app"> {{app.requestedAmount | currency:'INR'}} </td>
                    </ng-container>

                    <ng-container matColumnDef="appliedOn">
                        <th mat-header-cell *matHeaderCellDef> Applied On </th>
                        <td mat-cell *matCellDef="let app"> {{app.createdDate | date}} </td>
                    </ng-container>

                    <ng-container matColumnDef="status">
                        <th mat-header-cell *matHeaderCellDef> Status </th>
                        <td mat-cell *matCellDef="let app">
                            <span class="status-badge pending">{{app.status}}</span>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="actions">
                        <th mat-header-cell *matHeaderCellDef> Actions </th>
                        <td mat-cell *matCellDef="let app">
                            <button mat-stroked-button [color]="userRole === 'Manager' ? 'primary' : 'accent'"
                                (click)="reviewApplication(app.applicationNumber)">
                                {{ userRole === 'Manager' ? 'Review' : 'View' }}
                            </button>
                        </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                </table>
                <mat-paginator [length]="pendingState().totalCount" [pageSize]="pendingState().pageSize"
                    [pageIndex]="pendingState().pageIndex" [pageSizeOptions]="[5, 10, 20]"
                    (page)="onPendingPageChange($event)" showFirstLastButtons>
                </mat-paginator>
            </div>
        </mat-tab>

        <!-- Approved Tab -->
        <mat-tab label="Approved">
            <div class="table-container mat-elevation-z2">
                <table mat-table [dataSource]="approvedState().data">
                    <!-- Same Columns but read-only usage mostly -->
                    <ng-container matColumnDef="applicationNumber">
                        <th mat-header-cell *matHeaderCellDef> App Number </th>
                        <td mat-cell *matCellDef="let app"> {{app.applicationNumber}} </td>
                    </ng-container>

                    <ng-container matColumnDef="loanType">
                        <th mat-header-cell *matHeaderCellDef> Loan Type </th>
                        <td mat-cell *matCellDef="let app"> {{app.loanTypeName}} </td>
                    </ng-container>

                    <ng-container matColumnDef="amount">
                        <th mat-header-cell *matHeaderCellDef> Amount </th>
                        <td mat-cell *matCellDef="let app"> {{app.requestedAmount | currency:'INR'}} </td>
                    </ng-container>

                    <ng-container matColumnDef="appliedOn">
                        <th mat-header-cell *matHeaderCellDef> Applied On </th>
                        <td mat-cell *matCellDef="let app"> {{app.createdDate | date}} </td>
                    </ng-container>

                    <ng-container matColumnDef="status">
                        <th mat-header-cell *matHeaderCellDef> Status </th>
                        <td mat-cell *matCellDef="let app">
                            <span class="status-badge approved">{{app.status}}</span>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="actions">
                        <th mat-header-cell *matHeaderCellDef> Actions </th>
                        <td mat-cell *matCellDef="let app">
                            <button mat-icon-button [color]="userRole === 'Manager' ? 'accent' : 'primary'"
                                (click)="reviewApplication(app.applicationNumber)"
                                [matTooltip]="userRole === 'Manager' ? 'Review Application' : 'View Application'">
                                <mat-icon>visibility</mat-icon>
                            </button>
                        </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                </table>
                <mat-paginator [length]="approvedState().totalCount" [pageSize]="approvedState().pageSize"
                    [pageIndex]="approvedState().pageIndex" [pageSizeOptions]="[5, 10, 20]"
                    (page)="onApprovedPageChange($event)" showFirstLastButtons>
                </mat-paginator>
            </div>
        </mat-tab>

        <!-- Rejected Tab -->
        <mat-tab label="Rejected">
            <div class="table-container mat-elevation-z2">
                <table mat-table [dataSource]="rejectedState().data">
                    <!-- Same Columns -->
                    <ng-container matColumnDef="applicationNumber">
                        <th mat-header-cell *matHeaderCellDef> App Number </th>
                        <td mat-cell *matCellDef="let app"> {{app.applicationNumber}} </td>
                    </ng-container>

                    <ng-container matColumnDef="loanType">
                        <th mat-header-cell *matHeaderCellDef> Loan Type </th>
                        <td mat-cell *matCellDef="let app"> {{app.loanTypeName}} </td>
                    </ng-container>

                    <ng-container matColumnDef="amount">
                        <th mat-header-cell *matHeaderCellDef> Amount </th>
                        <td mat-cell *matCellDef="let app"> {{app.requestedAmount | currency:'INR'}} </td>
                    </ng-container>

                    <ng-container matColumnDef="appliedOn">
                        <th mat-header-cell *matHeaderCellDef> Applied On </th>
                        <td mat-cell *matCellDef="let app"> {{app.createdDate | date}} </td>
                    </ng-container>

                    <ng-container matColumnDef="status">
                        <th mat-header-cell *matHeaderCellDef> Status </th>
                        <td mat-cell *matCellDef="let app">
                            <span class="status-badge rejected">{{app.status}}</span>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="actions">
                        <th mat-header-cell *matHeaderCellDef> Actions </th>
                        <td mat-cell *matCellDef="let app">
                            <button mat-icon-button [color]="userRole === 'Manager' ? 'warn' : 'primary'"
                                (click)="reviewApplication(app.applicationNumber)"
                                [matTooltip]="userRole === 'Manager' ? 'Review Application' : 'View Application'">
                                <mat-icon>visibility</mat-icon>
                            </button>
                        </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                </table>
                <mat-paginator [length]="rejectedState().totalCount" [pageSize]="rejectedState().pageSize"
                    [pageIndex]="rejectedState().pageIndex" [pageSizeOptions]="[5, 10, 20]"
                    (page)="onRejectedPageChange($event)" showFirstLastButtons>
                </mat-paginator>
            </div>
        </mat-tab>
    </mat-tab-group>
</div>
